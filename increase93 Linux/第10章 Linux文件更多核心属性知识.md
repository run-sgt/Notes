## 第10章 Linux文件更多核心属性知识

2019-07-15 分类：[运维基础](https://www.increase93.com/?cat=5) 阅读(94) 评论(0)

1. ### Linux单用户多任务

**单用户多任务；比如我们以oldboy 登录系统，进入系统后，我要gedit 来写文档，但在写文档的过程中，我感觉少点音乐，所以又打开xmms 来点音乐；当然听点音乐还不行，MSN 还得打开，想知道几个用户现在正在做什么，这样一来，我在用oldboy 用户登录时，执行了gedit 、xmms以及msn等，当然还有输入法fcitx ；这样说来就有点简单了，一个oldboy用户，为了完成工作，执行了几个任务；当然oldboy这个用户，其它的人还能以远程登录过来，也能做其它的工作。**

1. ### Linux多用户多任务

**有时可能是很多用户同时用同一个系统，但并不所有的用户都一定都要做同一件事，所以这就有多用户多任务之说。**

**举个例子，比如LinuxSir.Org 服务器，上面有FTP 用户、系统管理员、web 用户、常规普通用户等，在同一时刻，可能有的用户正在访问论坛；有的可能在上传软件包管理子网站，比如luma 或Yuking 在管理他们的主页系统和FTP ；在与此同时，可能还会有系统管理员在维护系统；浏览主页的用的是nobody 用户，大家都用同一个，而上传软件包用的是FTP用户；管理员的对系统的维护或查看，可能用的是普通帐号或超级权限root帐号；不同用户所具有的权限也不同，要完成不同的任务得需要不同的用户，也可以说不同的用户，可能完成的工作也不一样；**

**值得注意的是：多用户多任务并不是大家同时挤到一起在一台机器的的键盘和显示器前来操作机器，多用户可能通过远程登录来进行，比如对服务器的远程控制，只要有用户权限任何人都是可以上去操作或访问的。**

1. ### 用户（user）介绍

**通过前面对Linux 多用户的理解，我们明白Linux 是真正意义上的多用户操作系统，所以我们能在Linux系统中创建若干用户（user）。比如我们的同事想用我的计算机，但我不想让他用我的用户名登录，因为我的用户名下有不想让别人看到的资料和信息（也就是隐私内容）这时我就可以给他建一个新的用户名，让他用我所开的用户名去登录，这从计算机安全角度来说是符合操作规则的。**

**当然用户（user）的概念理解还不仅仅于此，在Linux系统中还有一些用户是用来完成特定任务的，比如nobody和ftp 等，我们访问LinuxSir.Org 的网页程序，就是nobody用户；我们匿名访问ftp 时，会用到用户ftp或nobody ；如果您想了解Linux系统的一些帐号，请查看 /etc/passwd。**

1. ### Linux系统中用户角色划分

   1. #### 超级用户：root(皇帝)

- **系统唯一，是真实的，可以登录系统，可以操作系统任何文件和命令，拥有最高权限。**

1. #### 普通用户（老百姓）

- **这类用户能登录系统，但只能操作自己家目录的内容；权限有限；这类用户都是系统管理员自行添加的。**

1. #### 虚拟用户（傀儡）

- **这类用户也被称之为伪用户或假用户，与真实用户区分开来，这类用户不具有登录系统的能力，但却是系统运行不可缺少的用户，比如bin、daemon、adm、ftp、mail等；这类用户都系统自身拥有的，而非后来添加的，当然我们也可以添加虚拟用户。**
- **作用就是满足系统中的每个进程、服务都要有一个对应的用户和用户组**

1. ### Linux系统中不同用户角色对应的UID说明

**Linux 系统中，UID以如下的方式划分：**

**0 表示管理员（root）**

**1 - 500 表示系统虚拟用户**

**501 - 65535 表示普通用户**

**不同的Linux发行版，这些数字可能不一样。**

1. ### 多用户操作系统的安全

**多用户系统从事实来说对系统管理更为方便。从安全角度来说，多用户管理的系统更为安全，比如beinan用户下的某个文件不想让其它用户看到，只是设置一下文件的权限，只有beinan一个用户可读可写可编辑就行了，这样一来只有beinan一个用户可以对其私有文件进行操作，Linux 在多用户下表现最佳，Linux能很好的保护每个用户的安全，但我们也得学会Linux 才是，再安全的系统，如果没有安全意识的管理员或管理技术，这样的系统也不是安全的。**

**从服务器角度来说，多用户的下的系统安全性也是最为重要的，我们常用的Windows 操作系统，它在系统权限管理的能力只能说是一般般，根本没有没有办法和Linux或Unix 类系统相比。**

1. ### 用户组（group）介绍

- **用户组（group）就是具有相同特征的用户（user）的集合体；比如有时我们要让多个用户具有相同的权限，比如查看、修改某一文件或执行某个命令，这时我们需要用户组，我们把用户都定义到同一用户组，我们通过修改文件或目录的权限，让用户组具有一定的操作权限，这样用户组下的用户对该文件或目录都具有相同的权限，这是我们通过定义组和修改文件的权限来实现的。**
- **举例：我们为了让一些用户有权限查看某一文档，比如是一个时间表，而编写时间表的人要具有读写执行的权限，我们想让一些用户知道这个时间表的内容，而不让他们修改，所以我们可以把这些用户都划到一个组，然后来修改这个文件的权限，让用户组可读，这样用户组下面的每个用户都是可读的。**
- **用户和用户组的对应关系是：一对一、多对一、一对多或多对多；**
- **一对一：某个用户可以是某个组的唯一成员；**
- **多对一：多个用户可以是某个唯一的组的成员，不归属其它用户组；比如beinan和linuxsir两个用户只归属于beinan用户组；**
- **一对多：某个用户可以是多个用户组的成员；比如beinan可以是root组成员，也可以是linuxsir用户组成员，还可以是adm用户组成员；**
- **多对多：多个用户对应多个用户组，并且几个用户可以是归属相同的组；其实多对多的关系是前面三条的扩展；理解了上面的三条，这条也能理解；**

1. ### 用户及用户组相关命令

**useradd         添加用户**

**-u     给用户指定UID**

**-s         指定用户的shell命令解释器**

**-M     表示不创建家目录，创建虚拟用户使用**

**-g     指定用户组**

**-c         添加说明信息**

**passwd         设置密码**

**--stdin     非交互式设置密码**

**echo 123456 | passwd --stdin 用户名**

**whoami         我是谁，显示当前用户**

**su         切换用户**

**su -         切换用户的时候更新环境变量**

**-c         切换到另一个用户，运行一个命令, su - oldboy -c "pwd"**

**id             查看用户的uid,gid及归属的用户组**

**userdel         删除用户,默认不删除用户的家目录和邮箱**

**-r         删除与用户有关的所有信息**

**usermod         修改用户信息**

**-s     修改用户使用的shell**

**-g     修改属于的用户组，主要组**

**-u     修改UID**

**-c     修改用户说明**

**groupadd         创建用户组**

**-g     指定用户组并指定GID**

**groupdel         删除用户组，不能删除还有用户归属的主用户组**

1. ## 文件的权限

**以此示例图说明：**

![img](D:\Notes\md_img\071519_0711_10Linux1.png)

1. ### 文件权限说明

**列表的列定义如下：**

**[权限属性信息] [连接数] [拥有者] [拥有者所属用户组] [大小] [最后修改时间] [文件名]**

**权限属性列表为10个字符：**

- **第一个字符表示文件类型，d为目录 -为普通文件 l为连接 b为可存储的接口设备 c为键盘鼠标等输入设备**
- **2、3、4个字符表示所有者权限，5、6、7个字符表示所有者同组用户权限，8、9、10为其他用户权限**
- **第二个字符表示所有者读权限，如果有权限则为r，没有权限则为-**
- **第三个字符表示所有者写权限，如果有权限则为w，没有权限则为-**
- **第四个字符表示所有者执行权限，如果有权限则为x，没有权限则为-**
- **第五个字符表示所有者同组用户读权限，如果有权限则为r，没有权限则为-**
- **第六个字符表示所有者同组用户写权限，如果有权限则为w，没有权限则为-**
- **第七个字符表示所有者同组用户执行权限，如果有权限则为x，没有权限则为-**
- **第八个字符表示其他非同组读权限，如果有权限则为r，没有权限则为-**
- **第九个字符表示其他非同组写权限，如果有权限则为w，没有权限则为-**
- **第十个字符表示其他非同组执行权限，如果有权限则为x，没有权限则为-**

1. ### 文件的修改时间属性

**mtime modify time 修改时间 （文件内容变化）**

**ctime change time 属性改变的时间（文件属性；变化；大小；权限；inode;所有者用户硬链接数量）**

**acime access time 访问时间（cat）**

**怎样查看：**

​    **stat命令**

1. ## 索引节点（inode）

   1. ### 什么是索引节点（inode）

**Inode，中文意思是索引节点（index node）。在每个linux系统的存储设备或存储设备的分区被格式化为文件系统后，一般都有两部分：第一部分是inode，第二部分是block。Block是用来存储实际数据用的。例如：照片、视频等普通文件数据。而inode就是用来存储这些数据属性信息的。Inode包含的属性信息包括文件大小、属主、归属的用户组、读写权限、文件类型、修改时间等，还包含指向文件实体的指针功能（inode节点--block的对应关系），但是，唯独不包含文件名。**

**inode在文件系统中是唯一的。**

**一个文件无论多大都会必须占用至少一个inode和一个block。格式化数量：inode的数量会大于block的数量。**

**Inode除了记录文件属性的信息外，还会为每个文件进行信息索引，所以就有了inode的数值。操作系统根据指令，即可通过inode的值最快的找到相对应的文件实体。**

1. ### 查看文件内容与inode和block关系

**文件、inode、block之间的关系见下图。**

![img](D:\Notes\md_img\071519_0711_10Linux2.png)

**打个比方，比如一本书，存储设备或分区就相当于这本书，block相当于书中的每一页内容，而inode就相当于这本书前面的目录，一本书有很多内容，一个知识点可能有多页，如果想查找某部分或某知识点的内容，一般先查书的目录，通过目录能更快的找到想要看的内容。虽然不太恰当，但还是比较形象。**

![img](D:\Notes\md_img\071519_0711_10Linux3.png)

**inode为每个文件进行信息索引，所以就有了inode的数值，操作系统根据指令，能通过inode值最快的找到相应的文件。**

1. ### inode和block的特点

   1. #### inode的特点

**inode在文件系统中是唯一的。**

**一个文件至少要占用一个inode及一个block，多个文件可以占用同一个inode（硬链接）。**

1. #### block的特点

**一个block只能被一个文件使用，如果文件很小但block很大，会造成剩余空间的浪费，无法继续被其他文件使用。**

1. ### 查看和管理inode

**ls -i**

**df -i**

1. ## 链接的概念

**在linux中，链接可以分为两种：一种为硬链接（Hard Link），另一种为软链接或符号链接（Symbolic Link or Soft Link）。可以使用ln命令创建链接文件，不带参数时创建的是硬链接，使用-s参数创建的是软链接。**

1. ### 硬链接

   1. #### 硬链接链接数属性

**用法**

**ln [原文件] [目标文件]**

- **定义:**

**是指通过索引节点(Inode)来进行链接。在Linux文件系统中，保存在磁盘分区中的文件都会分配一个编号，称索引节点编号(Inode Index)成为Inode。在Linux中，多个文件拥有一个索引节点，成为硬链接。**

**主要作用和原理**

**防止重要文件被误删**

**文件系统原理：只要存在一个以上的硬链接，那么删除一个指向链接并不会影响索引节点本身和其他硬链接，只有最后一个硬链接删除时，数据无inode指向，会被磁盘在进行检查或者新数据覆盖时候被删除。**

1. ### 硬链接知识与实践

**1.具有相同inode的不同文件名**

**2.删除硬链接或者原文件之一，文件实体不会被删除**

**3.删除所有硬链接，数据会在被磁盘检查或者新数据写入时候删除回收。**

**4.可以给文件设置硬链接防止误删**

**5.通过ln [原文件] [目标文件]设置硬链接**

**6.通过rm –f 删除硬链接**

**7.文件目录不可创建硬链接，因为硬链接无法跨区**

1. ### 软链接知识与实践

**用法**

**ln –s [原文件] [目标文件]**

**定义**

**软链接也叫符号链接(symbolick link),是一个包含指向另一个文件的inode的信息的文本文件，然后通过inode访问数据block，原文件被删除则链接失效。**

1. ### 文件的软链接示例

**touch oldboy_file**

**ln -s oldboy_file oldboy_file_soft_link**

**ls -l oldboy_file oldboy_file_soft_link**

1. ### 目录的软链接示例

mkdir oldboy_dir

ln -s oldboy_dir oldboy_dir_soft_link

ls -l oldboy_dir oldboy_dir_soft_link

1. ### 软链接知识小结

1. **软链接类似于快捷方式，存放原文件路径，执行原文件**

2. **删除原文件，软链接依然存在，但是失效**

3. **执行ln –s [原文件] [目标文件]完成创建**

4. **软链接和原文件是不同类型文件，inode不同**

5. **rm –f 删除软链接**

6. **可以创建目录和文件的软链接，即可以跨区**

   1. ### 企业面试：请描述Linux中软链接和硬链接的区别

**1.从定义：linux系统中，链接有两种，一种被称为软链接，类似于快捷方式，存放指向原文件inode的信息，与原文件inode不同。一种是硬链接，与原文件有相同的inode，可以指向数据block。**

**2.从创建方式：硬链接命令 ln [原文件] [目标文件]，软链接命令ln –s [原文件] [目标文件]**

**3.从创建对象：ln命令不能对目录创建硬链接，但是可以对目录创建软链接。因为软链接可以跨越文件系统，，硬链接则不能。对目录和为客户创建的文件软链接经常用到。**

**4.删除软链接文件，对硬链接和原文件无影响。**

**5.删除文件硬链接，对原文件及软链接文件无影响**

**6.删除原文件，对硬链接读取数据无影响，软链接则失效。会出现红底白字状。**

**7.同时删除原文件和硬链接，原文件才会被真正删除**

**8.很多硬件设备中的快照原理，类似于硬链接原理**

1. ## 本章知识点总结与面试题

- **Linux用户与用户组**
- **相关用户和用户组的命令**
- **Linux文件权限**
- **Linux索引节点inode**
- **软硬连接区别（2-3分钟）**